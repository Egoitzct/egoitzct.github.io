{
  "hash": "28a8671d835543386b291fc65132a6d4",
  "result": {
    "markdown": "---\ntitle: \"Refugiados\"\ndescription: \"TidyTuesday del 22 de agosto de 2023\"\nauthor: \"Egoitz Carral\"\ndate: \"09/04/2023\"\nimage: \"image.jpg\"\ncategories: [2023, Plot, ggplot, ggrepel, TidyTuesday, Plotly] \ndate-modified: \"09/04/2023\"\nreference-location: block\nbibliography: referencias.bib\ncsl: https://www.zotero.org/styles/apa\nexecute: \n  freeze: true\n  cache: true\n---\n\n\nPara el TidyTuesday de la semana del 22 de agosto, el tema es sobre refugiados. Después de leer la descripción que podemos encontrar en la página de github, he decidido hacer un gráfico en el que se incluyan los diez países que más refugiados han recibido.\n\nCómo siempre, el primer paso es cargar el *dataset* y los paquetes que usaremos para hacer el gráfico (qué, además de un gráfico estático, también usaremos *plotly* para añadir un poco de interacción).\n\n\n::: {.cell hash='index_cache/html/dataset_download_e51791c289e3cab657ce144b0f88405d'}\n\n```{.r .cell-code}\npopulation <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-08-22/population.csv')\n\nlibrary(tidyverse)\nlibrary(janitor)\nlibrary(ggrepel)\nlibrary(scales)\nlibrary(plotly)\n```\n:::\n\n\nDespúes de cargar los datos, hay que observarlos y limpiarlos, de forma que todos los datos resultantes sean adecuados para hacer el gráfico.\n\n\n::: {.cell hash='index_cache/html/data-exploring_1a242c7c511577421328ca812cdccb9b'}\n\n```{.r .cell-code}\nglimpse(population)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 64,809\nColumns: 16\n$ year              <dbl> 2010, 2010, 2010, 2010, 2010, 2010, 2010, 2010, 2010…\n$ coo_name          <chr> \"Afghanistan\", \"Iran (Islamic Rep. of)\", \"Iraq\", \"Pa…\n$ coo               <chr> \"AFG\", \"IRN\", \"IRQ\", \"PAK\", \"ARE\", \"CHI\", \"GAZ\", \"IR…\n$ coo_iso           <chr> \"AFG\", \"IRN\", \"IRQ\", \"PAK\", \"EGY\", \"CHN\", \"PSE\", \"IR…\n$ coa_name          <chr> \"Afghanistan\", \"Afghanistan\", \"Afghanistan\", \"Afghan…\n$ coa               <chr> \"AFG\", \"AFG\", \"AFG\", \"AFG\", \"ALB\", \"ALB\", \"ALB\", \"AL…\n$ coa_iso           <chr> \"AFG\", \"AFG\", \"AFG\", \"AFG\", \"ALB\", \"ALB\", \"ALB\", \"AL…\n$ refugees          <dbl> 0, 30, 6, 6398, 5, 6, 5, 5, 49, 5, 5, 0, 0, 6, 6, 66…\n$ asylum_seekers    <dbl> 0, 21, 0, 9, 0, 0, 0, 0, 20, 0, 0, 5, 10, 92, 5, 26,…\n$ returned_refugees <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ idps              <dbl> 351907, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ returned_idps     <dbl> 3366, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ stateless         <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n$ ooc               <dbl> 838250, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ oip               <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n$ hst               <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n```\n:::\n\n```{.r .cell-code}\ndata <- population |> \n  filter(refugees >= 100) |> \n  select(year, coo_name, coo_iso, coa_name, coa_iso, refugees, asylum_seekers) |> \n  group_by(coa_iso)\n\ndata <- data |> \n  select(year, coa_name, coa_iso, refugees, asylum_seekers) |> \n  group_by(coa_iso)\n\ndata_plot <- data |>\n  group_by(coa_name) |> \n  summarise(refugees_sum = sum(refugees),\n            asylum_sum = sum(asylum_seekers)) |> \n  ungroup()\n\ndata_plot <- data_plot |> \n  filter(refugees_sum >= 10000 & asylum_sum >= 10000)\n\ndata_plot_1 <- data_plot |> \n  filter(refugees_sum >= 7000000)\n\ndata_plot_2 <- data_plot |> \n  filter(refugees_sum < 7000000) |> \n  adorn_totals(\"row\") |> \n  filter(coa_name == \"Total\")\n\ndata_plot_2$coa_name[1] <- \"Others\"\n\ndata_plot_1 <- data_plot_1 |> \n  arrange(refugees_sum)\n\ndata_plot <- rbind(data_plot_1, data_plot_2)\n```\n:::\n\n\nDespués de tener los datos tal y como los necesitamos, es hora de hacer ambos gráficos (estático e interactivo.\n\n\n::: {.cell layout-ncol=\"2\" hash='index_cache/html/static_plot_ea47868d8a7ef0824a3af015a0b01d8a'}\n\n```{.r .cell-code}\nplot <- data_plot_1 |> \n  mutate(coa_name=factor(coa_name, levels=coa_name)) |> \n  ggplot(aes(x = coa_name, y = refugees_sum)) +\n  geom_segment(aes(xend=coa_name, yend=0)) +\n  geom_point(size = 4, color = \"#0FDEE8\") +\n  coord_flip() +\n  xlab(\"\") +\n  ylab(\"Total number of refugees (World`s first 10 countries)\") +\n  theme_bw() +\n  geom_label_repel(aes(x = coa_name, label = refugees_sum)) +\n  scale_y_continuous(trans = log2_trans(),\n                     breaks = trans_breaks(\"log2\", function(x) 2^x),\n                     labels = label_number(scale_cut = cut_long_scale()))\n\ninteractive_plot <- data_plot_1 |> \n  mutate(coa_name=factor(coa_name, levels=coa_name)) |> \n  ggplot(aes(x = coa_name, y = refugees_sum)) +\n  geom_segment(aes(xend=coa_name, yend=0)) +\n  geom_point(size = 4, color = \"#FF7E0F\") +\n  coord_flip() +\n  xlab(\"\") +\n  ylab(\"Total number of refugees (World`s first 10 countries)\") +\n  theme_bw() +\n  scale_y_continuous(trans = log2_trans(),\n                     breaks = trans_breaks(\"log2\", function(x) 2^x),\n                     labels = label_number(scale_cut = cut_long_scale()))\n\nplot\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/static_plot-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplotly(interactive_plot)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div class=\"plotly html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-9d1ab8cf6833e60ebae0\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-9d1ab8cf6833e60ebae0\">{\"x\":{\"data\":[{\"x\":[22.916850939467917,null,null,22.942454010921296,null,null,23.013099259400473,null,null,23.20080403807491,null,null,23.362633463153763,null,null,23.370203421530778,null,null,24.265386700279333,null,null,24.819898990110516,null],\"y\":[1,1,null,2,2,null,3,3,null,4,4,null,5,5,null,6,6,null,7,7,null,8,8],\"text\":[\"coa_name: Sudan<br />refugees_sum:  7918803<br />coa_name: 1<br />yend: -Inf\",\"coa_name: Sudan<br />refugees_sum:  7918803<br />coa_name: 1<br />yend: -Inf\",null,\"coa_name: Jordan<br />refugees_sum:  8060590<br />coa_name: 2<br />yend: -Inf\",\"coa_name: Jordan<br />refugees_sum:  8060590<br />coa_name: 2<br />yend: -Inf\",null,\"coa_name: Ethiopia<br />refugees_sum:  8465121<br />coa_name: 3<br />yend: -Inf\",\"coa_name: Ethiopia<br />refugees_sum:  8465121<br />coa_name: 3<br />yend: -Inf\",null,\"coa_name: Lebanon<br />refugees_sum:  9641352<br />coa_name: 4<br />yend: -Inf\",\"coa_name: Lebanon<br />refugees_sum:  9641352<br />coa_name: 4<br />yend: -Inf\",null,\"coa_name: Uganda<br />refugees_sum: 10785827<br />coa_name: 5<br />yend: -Inf\",\"coa_name: Uganda<br />refugees_sum: 10785827<br />coa_name: 5<br />yend: -Inf\",null,\"coa_name: Germany<br />refugees_sum: 10842570<br />coa_name: 6<br />yend: -Inf\",\"coa_name: Germany<br />refugees_sum: 10842570<br />coa_name: 6<br />yend: -Inf\",null,\"coa_name: Pakistan<br />refugees_sum: 20165512<br />coa_name: 7<br />yend: -Inf\",\"coa_name: Pakistan<br />refugees_sum: 20165512<br />coa_name: 7<br />yend: -Inf\",null,\"coa_name: Türkiye<br />refugees_sum: 29616524<br />coa_name: 8<br />yend: -Inf\",\"coa_name: Türkiye<br />refugees_sum: 29616524<br />coa_name: 8<br />yend: -Inf\"],\"type\":\"scatter\",\"mode\":\"lines\",\"line\":{\"width\":1.8897637795275593,\"color\":\"rgba(0,0,0,1)\",\"dash\":\"solid\"},\"hoveron\":\"points\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null},{\"x\":[22.916850939467917,22.942454010921296,23.013099259400473,23.20080403807491,23.362633463153763,23.370203421530778,24.265386700279333,24.819898990110516],\"y\":[1,2,3,4,5,6,7,8],\"text\":[\"coa_name: Sudan<br />refugees_sum:  7918803\",\"coa_name: Jordan<br />refugees_sum:  8060590\",\"coa_name: Ethiopia<br />refugees_sum:  8465121\",\"coa_name: Lebanon<br />refugees_sum:  9641352\",\"coa_name: Uganda<br />refugees_sum: 10785827\",\"coa_name: Germany<br />refugees_sum: 10842570\",\"coa_name: Pakistan<br />refugees_sum: 20165512\",\"coa_name: Türkiye<br />refugees_sum: 29616524\"],\"type\":\"scatter\",\"mode\":\"markers\",\"marker\":{\"autocolorscale\":false,\"color\":\"rgba(255,126,15,1)\",\"opacity\":1,\"size\":15.118110236220474,\"symbol\":\"circle\",\"line\":{\"width\":1.8897637795275593,\"color\":\"rgba(255,126,15,1)\"}},\"hoveron\":\"points\",\"showlegend\":false,\"xaxis\":\"x\",\"yaxis\":\"y\",\"hoverinfo\":\"text\",\"frame\":null}],\"layout\":{\"margin\":{\"t\":26.228310502283108,\"r\":7.3059360730593621,\"b\":40.182648401826498,\"l\":57.716894977168963},\"plot_bgcolor\":\"rgba(255,255,255,1)\",\"paper_bgcolor\":\"rgba(255,255,255,1)\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724},\"xaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[22.821698536935788,24.915051392642646],\"tickmode\":\"array\",\"ticktext\":[\"8.4M\",\"11.9M\",\"16.8M\",\"23.7M\"],\"tickvals\":[23,23.5,24,24.5],\"categoryorder\":\"array\",\"categoryarray\":[\"8.4M\",\"11.9M\",\"16.8M\",\"23.7M\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(51,51,51,1)\",\"ticklen\":3.6529680365296811,\"tickwidth\":0.66417600664176002,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.68949771689498},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176002,\"zeroline\":false,\"anchor\":\"y\",\"title\":{\"text\":\"Total number of refugees (World`s first 10 countries)\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724}},\"hoverformat\":\".2f\"},\"yaxis\":{\"domain\":[0,1],\"automargin\":true,\"type\":\"linear\",\"autorange\":false,\"range\":[0.40000000000000002,8.5999999999999996],\"tickmode\":\"array\",\"ticktext\":[\"Sudan\",\"Jordan\",\"Ethiopia\",\"Lebanon\",\"Uganda\",\"Germany\",\"Pakistan\",\"Türkiye\"],\"tickvals\":[1,2,3,4,5,6,7,8],\"categoryorder\":\"array\",\"categoryarray\":[\"Sudan\",\"Jordan\",\"Ethiopia\",\"Lebanon\",\"Uganda\",\"Germany\",\"Pakistan\",\"Türkiye\"],\"nticks\":null,\"ticks\":\"outside\",\"tickcolor\":\"rgba(51,51,51,1)\",\"ticklen\":3.6529680365296811,\"tickwidth\":0.66417600664176002,\"showticklabels\":true,\"tickfont\":{\"color\":\"rgba(77,77,77,1)\",\"family\":\"\",\"size\":11.68949771689498},\"tickangle\":-0,\"showline\":false,\"linecolor\":null,\"linewidth\":0,\"showgrid\":true,\"gridcolor\":\"rgba(235,235,235,1)\",\"gridwidth\":0.66417600664176002,\"zeroline\":false,\"anchor\":\"x\",\"title\":{\"text\":\"\",\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":14.611872146118724}},\"hoverformat\":\".2f\"},\"shapes\":[{\"type\":\"rect\",\"fillcolor\":\"transparent\",\"line\":{\"color\":\"rgba(51,51,51,1)\",\"width\":0.66417600664176002,\"linetype\":\"solid\"},\"yref\":\"paper\",\"xref\":\"paper\",\"x0\":0,\"x1\":1,\"y0\":0,\"y1\":1}],\"showlegend\":false,\"legend\":{\"bgcolor\":\"rgba(255,255,255,1)\",\"bordercolor\":\"transparent\",\"borderwidth\":1.8897637795275593,\"font\":{\"color\":\"rgba(0,0,0,1)\",\"family\":\"\",\"size\":11.68949771689498}},\"hovermode\":\"closest\",\"barmode\":\"relative\"},\"config\":{\"doubleClick\":\"reset\",\"modeBarButtonsToAdd\":[\"hoverclosest\",\"hovercompare\"],\"showSendToCloud\":false},\"source\":\"A\",\"attrs\":{\"85ed2cdc04d1\":{\"x\":{},\"y\":{},\"xend\":{},\"yend\":{},\"type\":\"scatter\"},\"85ed20c04c59\":{\"x\":{},\"y\":{}}},\"cur_data\":\"85ed2cdc04d1\",\"visdat\":{\"85ed2cdc04d1\":[\"function (y) \",\"x\"],\"85ed20c04c59\":[\"function (y) \",\"x\"]},\"highlight\":{\"on\":\"plotly_click\",\"persistent\":false,\"dynamic\":false,\"selectize\":false,\"opacityDim\":0.20000000000000001,\"selected\":{\"opacity\":1},\"debounce\":0},\"shinyEvents\":[\"plotly_hover\",\"plotly_click\",\"plotly_selected\",\"plotly_relayout\",\"plotly_brushed\",\"plotly_brushing\",\"plotly_clickannotation\",\"plotly_doubleclick\",\"plotly_deselect\",\"plotly_afterplot\",\"plotly_sunburstclick\"],\"base_url\":\"https://plot.ly\"},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n::: {refs}\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.6.2/htmlwidgets.js\"></script>\n<script src=\"../../site_libs/plotly-binding-4.10.2/plotly.js\"></script>\n<script src=\"../../site_libs/typedarray-0.1/typedarray.min.js\"></script>\n<script src=\"../../site_libs/jquery-3.5.1/jquery.min.js\"></script>\n<link href=\"../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\n<link href=\"../../site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/plotly-main-2.11.1/plotly-latest.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}